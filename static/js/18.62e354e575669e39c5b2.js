webpackJsonp([18],{"+e8E":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n("3cXf"),a=n.n(l),o=n("4YfN"),r=n.n(o),s=n("aA9S"),i=n.n(s),m=n("OOvn"),d=n("Ap6m"),u=n("+ThO"),c=(n("/ADh"),{components:{searchForm:d.a,pagination:u.a},data:function(){return{formOptions:[{label:"业务类型",prop:"remindType",element:"el-select",options:[{label:"企业",value:1},{label:"商家",value:2},{label:"服务号",value:4},{label:"端口号",value:3},{label:"主页",value:6},{label:"菜单",value:5}]},{label:"提醒类型",prop:"remindSubType",element:"el-select",options:[{label:"审核结果",value:100},{label:"待审核",value:110},{label:"冻结",value:120},{label:"到期",value:132},{label:"到期前10天",value:131},{label:"到期前30天",value:130}]},{label:"短信提醒",prop:"smsRemind",element:"el-select",options:[{label:"是",value:2},{label:"否",value:1}]},{label:"模板内容",prop:"msgContent",element:"el-input"}],tableData:[],pages:{page:0,size:10,total:0},searchForm:{},tableLoading:!1,addShow:!1,modelForm:{msgContent:"",remindReceivers:"",remindSubType:"",remindType:"",smsContent:"",smsRemind:!1},isEdit:!1,button_loading:!1,rules:{msgContent:[{required:!0,message:"请输入站内消息模板",trigger:"change"}],remindSubType:[{required:!0,message:"请选择提醒类型",trigger:"change"}],remindType:[{required:!0,message:"请选择业务类型",trigger:"change"}],smsContent:[{required:!0,message:"请输入短信模板",trigger:"change"}],remindReceivers:[{required:!0,message:"请选择大于1但不超过5个的提醒人",trigger:"change"}]},userList:[],formOptionsType:[]}},watch:{},computed:{},created:function(){var e=this;this.getUserlist(),Object(m.t)({page:0,size:1e5}).then(function(t){var n=t.data;0===n.subCode?e.userList=n.data:e.message.error(n.message)}).catch(function(e){})},mounted:function(){},methods:{getUserlist:function(){var e=this;this.tableLoading=!0;var t=i()({},{page:this.pages.page,size:this.pages.size},this.searchForm);Object(m.D)(r()({},t)).then(function(t){var n=t.data;e.tableLoading=!1,0===n.subCode&&(n.data.map(function(t){i()(t,e.getName(t))}),e.tableData=n.data,e.pages=n.pageInfo)})},getName:function(e){for(var t={remindName:"",remindSubName:"",isSmsRemind:2==e.smsRemind?"是":"否"},n=0;n<this.formOptions[0].options.length;n++)this.formOptions[0].options[n].value==e.remindType&&(t.remindName=this.formOptions[0].options[n].label);for(var l=0;l<this.formOptions[1].options.length;l++)this.formOptions[1].options[l].value==e.remindSubType&&(t.remindSubName=this.formOptions[1].options[l].label);return t},onSearch:function(e){this.searchForm=i()({},e),this.pages.page=0,this.getUserlist()},changeSize:function(e){this.pages=e,this.getUserlist()},delModel:function(e){var t=this;this.tableLoading=!0,Object(m.j)({remindId:e.remindId}).then(function(e){var n=e.data;t.tableLoading=!1,0==n.subCode&&(t.$message.success("删除成功"),t.getUserlist())})},addModelShow:function(e){var t=this;this.checkData=e||{},e?(this.isEdit=!0,this.tableLoading=!0,Object(m.E)({remindId:e.remindId}).then(function(n){var l=n.data;if(t.tableLoading=!1,0===l.subCode){t.addShow=!0;var o=l.data.map(function(e){return e.userName}),r=JSON.parse(a()(t.userList)).filter(function(e){return-1!=o.indexOf(e.userName)});t.setRemindSubType(e.remindType),t.modelForm={msgContent:e.msgContent,remindReceivers:r.length>0?r:[],remindSubType:e.remindSubType,remindType:e.remindType,smsContent:e.smsContent,smsRemind:2==e.smsRemind}}})):(this.addShow=!0,this.isEdit=!1,this.modelForm={msgContent:"",remindReceivers:"",remindSubType:"",remindType:"",smsContent:"",smsRemind:!1},this.$nextTick(function(){console.log(1),t.$refs.form.resetFields()}))},addmodel:function(){var e=this;this.$refs.form.validate(function(t){if(t){e.button_loading=!0;var n=i()({},e.modelForm);n.smsRemind=n.smsRemind?2:1,n.smsContent=2==n.smsRemind?n.smsContent:"";var l=[];n.remindReceivers.map(function(e){l.push({userName:e.userName})}),n.remindReceivers=l,e.isEdit?Object(m.M)(r()({},n,{remindId:e.checkData.remindId})).then(function(t){var n=t.data;e.button_loading=!1,0==n.subCode&&(e.addShow=!1,e.$message.success("编辑成功"),e.getUserlist())}):Object(m.d)(r()({},n)).then(function(t){var n=t.data;e.button_loading=!1,0==n.subCode&&(e.addShow=!1,e.$message.success("添加成功"),e.getUserlist())})}})},setRemindSubType:function(e){switch(this.modelForm.remindSubType="",e){case 2:this.formOptionsType=[{value:100,label:"审核结果"},{value:110,label:"待审核"},{value:132,label:"到期"},{value:131,label:"到期前10天"},{value:130,label:"到期前30天"}];break;case 4:this.formOptionsType=[{value:100,label:"审核结果"},{value:110,label:"待审核"},{value:120,label:"冻结"},{value:132,label:"到期"},{value:131,label:"到期前10天"},{value:130,label:"到期前30天"}];break;default:this.formOptionsType=[{value:100,label:"审核结果"},{value:110,label:"待审核"}]}},setRemindReceivers:function(){this.modelForm.remindReceivers=[]},removeRemindReceivers:function(e){this.modelForm.remindReceivers=this.modelForm.remindReceivers.filter(function(t,n){return n!=e})}}}),p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"commonClass messagemodal"},[n("div",{staticClass:"commonClass-right"},[n("div",{staticClass:"commonClass-right-title"},[n("p",{staticClass:"commonClass-right-title-left"},[e._v("模板列表")]),e._v(" "),n("el-button",{staticClass:"commonClass-right-title-right",attrs:{type:"primary"},on:{click:function(t){return e.addModelShow()}}},[n("i",{staticClass:"el-icon-plus"}),e._v("新增模板")])],1),e._v(" "),n("div",{staticClass:"el-card-body"},[n("searchForm",{attrs:{formOptions:e.formOptions},on:{onSearch:e.onSearch}}),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{size:"medium",border:"",data:e.tableData}},[n("el-table-column",{attrs:{align:"center",prop:"remindName",label:"业务类型"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"remindSubName",label:"提醒消息"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"msgContent",label:"站内消息模板内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.msgContent?t.row.msgContent:"-")+"\n                    ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"isSmsRemind",label:"短信提醒"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"smsContent",label:"短信模板内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.smsContent?t.row.smsContent:"-")+"\n                    ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"updateTime",label:"修改时间"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"updater",label:"操作人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.updater?t.row.updater:"-")+"\n                    ")]}}])}),e._v(" "),n("el-table-column",{attrs:{width:"200",align:"center",prop:"status",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{staticStyle:{"margin-right":"20px"},on:{click:function(n){return e.addModelShow(t.row)}}},[e._v("修改")]),e._v(" "),n("el-popconfirm",{attrs:{title:"是否删除此模板"},on:{onConfirm:function(n){return e.delModel(t.row,2)}}},[n("el-tag",{attrs:{slot:"reference",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),n("pagination",{attrs:{page:e.pages.page,size:e.pages.size,total:e.pages.total},on:{getPaginationData:e.changeSize}})],1)]),e._v(" "),n("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:(e.isEdit?"编辑":"添加")+"模板",visible:e.addShow,top:"5vh",width:"800px"},on:{"update:visible":function(t){e.addShow=t}}},[n("el-form",{ref:"form",attrs:{size:"medium",model:e.modelForm,rules:e.rules,"label-width":"110px"}},[n("el-form-item",{attrs:{prop:"remindType",label:"业务类型"}},[n("el-select",{staticClass:"width100",attrs:{clearable:""},on:{change:e.setRemindSubType},model:{value:e.modelForm.remindType,callback:function(t){e.$set(e.modelForm,"remindType",t)},expression:"modelForm.remindType"}},e._l(e.formOptions[0].options,function(e,t){return n("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{prop:"remindSubType",label:"提醒类型"}},[n("el-select",{staticClass:"width100",attrs:{clearable:""},on:{change:e.setRemindReceivers},model:{value:e.modelForm.remindSubType,callback:function(t){e.$set(e.modelForm,"remindSubType",t)},expression:"modelForm.remindSubType"}},e._l(e.formOptionsType,function(e,t){return n("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{prop:"msgContent",label:"站内消息模板"}},[n("el-input",{attrs:{clearable:"",maxlength:"30",type:"textarea",rows:3,placeholder:"请输入不超过30字的站内消息模板"},model:{value:e.modelForm.msgContent,callback:function(t){e.$set(e.modelForm,"msgContent","string"==typeof t?t.trim():t)},expression:"modelForm.msgContent"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"短信提醒"}},[n("el-switch",{model:{value:e.modelForm.smsRemind,callback:function(t){e.$set(e.modelForm,"smsRemind",t)},expression:"modelForm.smsRemind"}})],1),e._v(" "),e.modelForm.smsRemind?n("el-form-item",{attrs:{prop:"smsContent",label:"短信模板"}},[n("el-input",{attrs:{clearable:"",maxlength:"30",type:"textarea",rows:3,placeholder:"请输入不超过30字的短信模板"},model:{value:e.modelForm.smsContent,callback:function(t){e.$set(e.modelForm,"smsContent","string"==typeof t?t.trim():t)},expression:"modelForm.smsContent"}})],1):e._e(),e._v(" "),n("el-form-item",{attrs:{prop:e.modelForm.remindSubType&&100!=e.modelForm.remindSubType?"remindReceivers":"",label:"提醒人"}},[e._v("\n                "+e._s(-1!=[120,130,131,132].indexOf(e.modelForm.remindSubType)?"企业主账号（消息推送给企业的主账号）":"")+"\n                "+e._s(100==e.modelForm.remindSubType?"资料提交者（包括客户侧用户、运营侧用户）":"")+"\n                "+e._s(e.modelForm.remindSubType?"":"请选择提醒类型")+"\n                "),e.modelForm.remindSubType&&100!=e.modelForm.remindSubType?n("el-select",{staticClass:"width100",staticStyle:{"margin-bottom":"10px"},attrs:{"value-key":"id",multiple:"",filterable:"","multiple-limit":5,clearable:""},model:{value:e.modelForm.remindReceivers,callback:function(t){e.$set(e.modelForm,"remindReceivers",t)},expression:"modelForm.remindReceivers"}},e._l(e.userList,function(e,t){return n("el-option",{key:t,attrs:{label:(e.userName?e.userName:"")+(e.realName?"-"+e.realName:"")+(e.mobile?"-"+e.mobile:""),value:e}})}),1):e._e(),e._v(" "),e.modelForm.remindSubType&&100!=e.modelForm.remindSubType?n("el-table",{attrs:{"value-key":"id",data:e.modelForm.remindReceivers}},[n("el-table-column",{attrs:{align:"center",prop:"userName",label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(t.row.userName?t.row.userName:"-")+"\n                        ")]}}],null,!1,821490805)}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"realName",label:"姓名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(t.row.realName?t.row.realName:"-")+"\n                        ")]}}],null,!1,1297351445)}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"mobile",label:"手机号码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(t.row.mobile?t.row.mobile:"-")+"\n                        ")]}}],null,!1,1737004213)}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"remindSubName",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("i",{staticClass:"el-icon-remove-outline",on:{click:function(n){return e.removeRemindReceivers(t.$index)}}})]}}],null,!1,2292912715)})],1):e._e()],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.addShow=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{loading:e.button_loading,type:"primary"},on:{click:e.addmodel}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var b=n("C7Lr")(c,p,!1,function(e){n("xWkY")},"data-v-508f9f3e",null);t.default=b.exports},xWkY:function(e,t){}});