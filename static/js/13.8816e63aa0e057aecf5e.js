webpackJsonp([13],{RiOC:function(a,e){},gCcO:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t("aA9S"),o=t.n(n),i=t("4YfN"),r=t.n(i),s=t("OOvn"),l=t("Ap6m"),d=t("+ThO"),c=t("/ADh"),u=t.n(c),g=t("fUgm"),m={name:"organization",components:{searchForm:l.a,pagination:d.a},data:function(){return{treeLoading:!1,tableLoading:!1,searchVal:"",organnizationList:[],addShow:!1,button_loading:!1,organizationForm:{name:"",note:"",status:0},isEdit:!1,rules:{name:[{required:!0,message:"请输入组织名称",trigger:"change"},{validator:u.a.FormValidate.Form().validateContacts,trigger:"change"}],note:[{required:!0,message:"请输入组织描述",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},checkData:{},clickData:{data:{name:"服务号中心",id:null,level:0,status:1}},formOptions:[{label:"用户名",prop:"userName",element:"el-input"},{label:"手机号码",prop:"mobile",element:"el-input"},{label:"状态",prop:"status",element:"el-select",options:[{label:"启用",value:1},{label:"禁用",value:0}]}],tableData:[],pages:{page:0,size:10,total:0},searchForm:{}}},created:function(){this.getUserlist()},mounted:function(){},computed:r()({},Object(g.c)({includePages:function(a){return a.includePages}})),watch:{},methods:{getOrganization:function(){var a=this;Object(s.C)({level:1,page:0,size:1e4,parentOrgCode:null}).then(function(e){var t=e.data;0===t.subCode&&(a.organnizationList=[{children:t.data,name:"服务号中心",id:null}],a.$forceUpdate())})},getUserlist:function(){var a=this;this.tableLoading=!0,Object(s.t)({orgCode:this.clickData.data.orgCode,page:this.pages.page,size:this.pages.size,mobile:this.searchForm.mobile,status:this.searchForm.status,userName:this.searchForm.userName}).then(function(e){var t=e.data;a.tableLoading=!1,0===t.subCode&&(a.tableData=t.data,a.pages=t.pageInfo)})},onSearch:function(a){this.searchForm=o()({},a),this.pages.page=0,this.getUserlist()},changeSize:function(a){this.pages=a,this.getUserlist()},handleNodeClick:function(a,e){this.clickData=e,this.pages.page=0,this.getUserlist()},loadNode:function(a,e){if(0===a.level)return e([{name:"服务号中心",id:1e9,level:0,orgCode:null}]);Object(s.C)({level:a.level,page:0,size:1e4,queryAbout:1,parentOrgCode:a.data.orgCode?a.data.orgCode:null}).then(function(t){var n=t.data;if(0===n.subCode)return 3==a.level&&n.data.map(function(a){a.leaf=!0}),e(n.data)})},addOrganizationShow:function(a,e){var t=this;this.addShow=!0,this.checkData=a||{},"isEdit"==e?(this.isEdit=!0,this.organizationForm={status:1==a.data.status?1:0,name:a.data.name,note:a.data.note}):(this.isEdit=!1,this.$nextTick(function(){t.$refs.form.resetFields()}))},search:function(){var a=this;this.treeLoading=!0,Object(s.A)({keyWords:this.searchVal}).then(function(e){var t=e.data;a.treeLoading=!1,0===t.subCode&&(t.data.map(function(a){a.children=null}),a.$refs.tree.updateKeyChildren(1e9,t.data))})},addOrganization:function(){var a=this;this.$refs.form.validate(function(e){e&&(a.button_loading=!0,a.isEdit?Object(s.L)({id:a.checkData.data.id,level:a.checkData.level?a.checkData.level:1,name:a.organizationForm.name,note:a.organizationForm.note,parentOrgCode:a.checkData.data?a.checkData.data.orgCode:null,status:a.organizationForm.status}).then(function(e){var t=e.data;if(a.button_loading=!1,0===t.subCode){a.addShow=!1;var n=r()({},a.checkData),o=n.parent.childNodes.map(function(a){return a.data});o.map(function(a){a.id==n.data.id&&(a.name=t.data.name,a.note=t.data.note,a.status=t.data.status)}),a.$refs.tree.updateKeyChildren(n.parent.data.id,o),a.clickData.data&&a.$refs.tree.setCurrentKey(a.clickData.data.id)}}):Object(s.K)({level:a.checkData.level?a.checkData.level:1,name:a.organizationForm.name,note:a.organizationForm.note,parentOrgCode:a.checkData.data?a.checkData.data.orgCode:null}).then(function(e){var t=e.data;a.button_loading=!1,0===t.subCode&&(a.addShow=!1,t.data.leaf=!0,a.$refs.tree.append(t.data,a.checkData.data?a.checkData.data.id:1e9))}))})}}},p={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"commonClass organization"},[t("div",{staticClass:"organization-left"},[t("el-form",{attrs:{inline:""},nativeOn:{submit:function(a){a.preventDefault()}}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"输入组织名称"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.search(e)}},model:{value:a.searchVal,callback:function(e){a.searchVal="string"==typeof e?e.trim():e},expression:"searchVal"}})],1),a._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return a.addOrganizationShow(e)}}},[t("i",{staticClass:"el-icon-plus"}),a._v("一级组织")])],1)],1),a._v(" "),t("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:a.treeLoading,expression:"treeLoading"}],ref:"tree",attrs:{"node-key":"id",lazy:"",props:{isLeaf:"leaf"},load:a.loadNode,"default-expanded-keys":[1e9],"expand-on-click-node":!1},on:{"node-click":a.handleNodeClick},scopedSlots:a._u([{key:"default",fn:function(e){var n=e.node,o=e.data;return t("span",{staticClass:"custom-tree-node"},[t("span",{class:"custom-tree-node-span"+(0==o.status?" custom-tree-node-disabled":"")},[a._v(a._s(o.name))]),a._v(" "),1!==n.level?t("span",{staticClass:"custom-tree-node-edit"},[t("i",{staticClass:"el-icon-edit",on:{click:function(e){return e.stopPropagation(),a.addOrganizationShow(n,"isEdit")}}}),a._v(" "),n.level<4?t("i",{staticClass:"el-icon-plus",on:{click:function(e){return e.stopPropagation(),a.addOrganizationShow(n)}}}):a._e()]):a._e()])}}])})],1),a._v(" "),t("div",{staticClass:"organization-right"},[t("el-form",{attrs:{inline:"","label-width":"90px"}},[t("el-row",[t("el-col",{attrs:{span:7}},[t("el-form-item",{attrs:{label:"组织名称："}},[a._v(a._s(a.clickData.data.name))])],1),a._v(" "),t("el-col",{attrs:{span:7}},[t("el-form-item",{attrs:{label:"组织描述："}},[t("p",[a._v(a._s(0==a.clickData.data.level?"服务号中心":a.clickData.data.note))])])],1),a._v(" "),t("el-col",{attrs:{span:7}},[t("el-form-item",{attrs:{label:"状态："}},[a._v(a._s(1==a.clickData.data.status?"启用":"禁用"))])],1)],1)],1),a._v(" "),t("div",{staticClass:"commonClass-right-title"},[a._v("用户列表")]),a._v(" "),t("div",{staticClass:"el-card-body"},[t("searchForm",{attrs:{formOptions:a.formOptions},on:{onSearch:a.onSearch}}),a._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:a.tableLoading,expression:"tableLoading"}],attrs:{size:"medium",border:"",data:a.tableData}},[t("el-table-column",{attrs:{align:"center",prop:"userName",label:"用户名"}}),a._v(" "),t("el-table-column",{attrs:{align:"center",prop:"realName",label:"姓名"}}),a._v(" "),t("el-table-column",{attrs:{align:"center",prop:"mobile",label:"手机号码"}}),a._v(" "),t("el-table-column",{attrs:{align:"center",prop:"note",label:"描述"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v("\n              "+a._s(e.row.note?e.row.note:"-")+"\n          ")]}}])}),a._v(" "),t("el-table-column",{attrs:{align:"center",prop:"orgName",label:"所属组织"},scopedSlots:a._u([{key:"default",fn:function(e){return[t("el-tag",{attrs:{effect:"dark"}},[a._v(a._s(e.row.orgName))])]}}])}),a._v(" "),t("el-table-column",{attrs:{align:"center",prop:"status",label:"状态"},scopedSlots:a._u([{key:"default",fn:function(e){return[t("el-tag",{attrs:{type:1==e.row.status?"success":"danger"}},[a._v(a._s(1==e.row.status?"启用":"禁用"))])]}}])})],1),a._v(" "),t("pagination",{attrs:{page:a.pages.page,size:a.pages.size,total:a.pages.total},on:{getPaginationData:a.changeSize}})],1)],1),a._v(" "),t("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:(a.isEdit?"编辑":"添加")+"组织机构",visible:a.addShow,width:"500px"},on:{"update:visible":function(e){a.addShow=e}}},[t("el-form",{ref:"form",attrs:{model:a.organizationForm,rules:a.rules,"label-width":"96px"}},[t("el-form-item",{attrs:{prop:"name",label:"组织名称："}},[t("el-input",{attrs:{maxlength:"30",placeholder:"支持汉字，数字，英文不超过30个字"},model:{value:a.organizationForm.name,callback:function(e){a.$set(a.organizationForm,"name","string"==typeof e?e.trim():e)},expression:"organizationForm.name"}})],1),a._v(" "),t("el-form-item",{attrs:{prop:"note",label:"描述："}},[t("el-input",{attrs:{maxlength:"100",type:"textarea",rows:4,placeholder:"不超过100个字"},model:{value:a.organizationForm.note,callback:function(e){a.$set(a.organizationForm,"note","string"==typeof e?e.trim():e)},expression:"organizationForm.note"}})],1),a._v(" "),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:a.isEdit,expression:"isEdit"}],attrs:{prop:"status",label:"状态："}},[t("el-radio",{attrs:{label:1},model:{value:a.organizationForm.status,callback:function(e){a.$set(a.organizationForm,"status",e)},expression:"organizationForm.status"}},[a._v("启用")]),a._v(" "),t("el-radio",{attrs:{label:0},model:{value:a.organizationForm.status,callback:function(e){a.$set(a.organizationForm,"status",e)},expression:"organizationForm.status"}},[a._v("禁用")])],1)],1),a._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(e){a.addShow=!1}}},[a._v("取 消")]),a._v(" "),t("el-button",{attrs:{loading:a.button_loading,type:"primary"},on:{click:a.addOrganization}},[a._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var h=t("C7Lr")(m,p,!1,function(a){t("RiOC")},null,null);e.default=h.exports}});